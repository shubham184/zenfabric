<!-- Web Manifest -->
<link rel="manifest" href="/site.webmanifest">
<meta name="theme-color" content="#2563EB">

<!-- Schema.org structured data for SEO and AI discoverability -->
{{- if .IsPage }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "headline": "{{ .Title }}",
  "description": "{{ with .Description }}{{ . }}{{ else }}{{ .Summary | truncate 150 }}{{ end }}",
  "author": {
    "@type": "Person",
    "name": "{{ site.Params.author }}",
    "url": "{{ site.BaseURL }}about/"
  },
  "datePublished": "{{ .Date.Format "2006-01-02" }}",
  "dateModified": "{{ .Lastmod.Format "2006-01-02" }}",
  "publisher": {
    "@type": "Organization",
    "name": "{{ site.Title }}",
    "url": "{{ site.BaseURL }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ site.BaseURL }}apple-touch-icon.png"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ .Permalink }}"
  },
  "keywords": [{{- range $i, $tag := .Params.tags }}{{ if $i }}, {{ end }}"{{ $tag }}"{{ end }}],
  "articleSection": "{{ .Section }}"
}
</script>
{{- else if .IsHome }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "{{ site.Title }}",
  "description": "{{ site.Params.description }}",
  "url": "{{ site.BaseURL }}",
  "author": {
    "@type": "Person",
    "name": "{{ site.Params.author }}"
  },
  "potentialAction": {
    "@type": "SearchAction",
    "target": "{{ site.BaseURL }}search/?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>
{{- end }}

<!-- Preconnect to Google Fonts for performance -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<!-- Hamburger Menu, Reading Progress, and Header Scroll JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // ===== HAMBURGER MENU =====
  const menuToggle = document.getElementById('menu-toggle');
  const menu = document.getElementById('menu');

  // Create overlay element
  const overlay = document.createElement('div');
  overlay.className = 'menu-overlay';
  document.body.appendChild(overlay);

  if (menuToggle && menu) {
    menuToggle.addEventListener('click', function() {
      menuToggle.classList.toggle('active');
      menu.classList.toggle('active');
      overlay.classList.toggle('active');
      document.body.style.overflow = menu.classList.contains('active') ? 'hidden' : '';
    });

    // Close menu when clicking overlay
    overlay.addEventListener('click', function() {
      menuToggle.classList.remove('active');
      menu.classList.remove('active');
      overlay.classList.remove('active');
      document.body.style.overflow = '';
    });

    // Close menu when clicking a link
    menu.querySelectorAll('a').forEach(function(link) {
      link.addEventListener('click', function() {
        if (window.innerWidth <= 768) {
          menuToggle.classList.remove('active');
          menu.classList.remove('active');
          overlay.classList.remove('active');
          document.body.style.overflow = '';
        }
      });
    });
  }

  // ===== READING PROGRESS BAR =====
  if (document.querySelector('.post-single')) {
    const progressBar = document.createElement('div');
    progressBar.className = 'reading-progress';
    document.body.prepend(progressBar);

    window.addEventListener('scroll', function() {
      const article = document.querySelector('.post-content');
      if (article) {
        const articleTop = article.offsetTop;
        const articleHeight = article.offsetHeight;
        const windowHeight = window.innerHeight;
        const scrolled = window.scrollY;

        const progress = Math.min(
          Math.max((scrolled - articleTop + windowHeight) / articleHeight, 0),
          1
        );

        progressBar.style.width = (progress * 100) + '%';
      }
    });
  }

  // ===== HEADER SCROLL EFFECT =====
  const header = document.querySelector('.header');
  if (header) {
    window.addEventListener('scroll', function() {
      if (window.scrollY > 50) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
    });
  }
});
</script>
